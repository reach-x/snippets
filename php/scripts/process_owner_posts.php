<?php


$data = file($argv[1]);

if (!is_array($data)) {
    die("There was a problem loading the file\n");
}

printf("Loaded %d lines\n", count($data));
$processed = array();
$fields = get_fields();

foreach ($data as $datum) {
    $row = str_getcsv($datum);
    $owner_post_id = $row[0];
    $email_address_id = $row[1];
    $field_id = $row[2];
    $value = $row[3];

    //print_r(array(
    //    '$owner_post_id' => $owner_post_id,
    //    '$email_address_id' => $email_address_id,
    //    '$field_id' => $field_id,
    //    '$value' => $value,
    //    '$datum' => $datum
    //));

    if (isset($processed[$email_address_id][$field_id])) {
        $processed[$email_address_id][$field_id]++;
        //printf("%d", $processed[$email_address_id][$field_id]);
    } else {
        if (isset($fields[$field_id])) {
            $sql = "UPDATE sight_saver_email_addresses_to_clean SET {$fields[$field_id]} = '{$value}' WHERE email_address_id={$email_address_id};";
            $processed[$email_address_id][$field_id] = 1;
            printf("%s\n", $sql);
        } else {
            print_r(array('no field' => $datum));
        }
    }
}


function get_fields()
{
    return array(
        '236' => '10K_CREDIT_CARD_DEBT',
        '153' => '10K_OR_OVER_DEBT',
        '298' => 'AARP_OPT_IN',
        '114' => 'ACCOUNT_ID',
        '277' => 'ACCOUNT_NUMBER',
        '275' => 'ACCOUNT_TYPE',
        '171' => 'ACTION_TYPE',
        '45' => 'ADDRESS_MONTHS',
        '44' => 'ADDRESS_YEARS',
        '70' => 'AFFILIATE_ID',
        '261' => 'AFFORD_HEALTH_INSURANCE',
        '72' => 'AGE',
        '118' => 'AGREE_TERMS',
        '105' => 'AID',
        '247' => 'AIRLINE_NAME',
        '93' => 'ALTERNATE_PHONE',
        '181' => 'AMOUNT_SMOKED',
        '206' => 'APARTMENT',
        '91' => 'APPLICATION_TO_COMPANY',
        '95' => 'AREA_OF_STUDY',
        '246' => 'ARRIVAL_AIRPORT',
        '191' => 'AUCTION_KEY',
        '280' => 'BANK_ACCOUNT_AGE',
        '279' => 'BANK_NAME',
        '278' => 'BANK_PHONE',
        '10' => 'BIRTH_DATE',
        '306' => 'BODY_TYPE',
        '131' => 'bpnumber',
        '30' => 'BUSINESS_PHONE',
        '242' => 'BUYER_ID',
        '226' => 'C1',
        '287' => 'C2',
        '288' => 'C3',
        '60' => 'CAMPAIGN',
        '66' => 'CAMPAIGN_ID',
        '265' => 'CAMPUS',
        '173' => 'CAPTURED_AT',
        '64' => 'CAPTURE_DATE',
        '224' => 'CARD_TYPE',
        '74' => 'CAREER_PRIMARY_FOCUS',
        '75' => 'CAREER_SECONDARY_FOCUS',
        '232' => 'CAR_INSURANCE',
        '193' => 'CAR_MAKE',
        '196' => 'CAR_MILEAGE',
        '194' => 'CAR_MODEL',
        '195' => 'CAR_TRIM',
        '198' => 'CAR_VERIFY',
        '197' => 'CAR_VIN',
        '192' => 'CAR_YEAR',
        '168' => 'CATEGORY_ID',
        '269' => 'CATEGORY_NAME',
        '179' => 'CIGARETTE_BRAND',
        '180' => 'CIGARETTE_TYPE',
        '7' => 'CITY',
        '136' => 'CLICKPATH_ID',
        '134' => 'CLICKPATH_STEP_ID',
        '135' => 'CLICKPATH_X_CLICKPATH_STEP_ID',
        '212' => 'CLICKS',
        '207' => 'COMPANY_NAME',
        '123' => 'CONDITIONS',
        '71' => 'COUNTRY',
        '229' => 'COUNTY',
        '125' => 'COVERAGE_AMOUNT',
        '157' => 'COVERAGE_TYPE',
        '83' => 'COVER_LETTER',
        '289' => 'CREATIVE_ID',
        '272' => 'CREDIT CARD COUNT',
        '260' => 'CREDIT_CARD_DEBT_OPT_IN',
        '89' => 'CREDIT_RATING',
        '234' => 'CREDIT_REPAIR',
        '295' => 'CREDIT_REPAIR_OPT_IN',
        '178' => 'CTID',
        '160' => 'CURRENTLY_EMPLOYED',
        '318' => 'CURRENTLY_INSURED',
        '14' => 'CUSTOMER_FIELD',
        '217' => 'DATA_AGE',
        '133' => 'DATE_OF_BIRTH',
        '97' => 'DEAL_KEY',
        '159' => 'DEBT_AMOUNT',
        '87' => 'DEGREE_PROGRAM',
        '245' => 'DEPARTURE_AIRPORT',
        '82' => 'DESCRIPTION',
        '200' => 'DESIRED_DWELLING_TYPE',
        '202' => 'DESIRED_TYPE_OF_LOAN',
        '116' => 'DIRECT_DEPOSIT',
        '104' => 'DISTRIBUTOR',
        '58' => 'DOMAIN_ID',
        '221' => 'DRUGDISCOUNT',
        '220' => 'DRUGNAME',
        '77' => 'EDUCATION_LEVEL',
        '53' => 'ELECTRIC_SUPPLIER',
        '183' => 'ELECTRONIC_CIGARETTE',
        '3' => 'EMAIL_ADDRESS_raw',
        '127' => 'EMAIL_ADDRESS_CONFIRM',
        '170' => 'EMAIL_ADDRESS_ID',
        '117' => 'EMAIL_OPT_IN',
        '37' => 'EMPLOYED_MONTHS',
        '36' => 'EMPLOYED_YEARS',
        '210' => 'EMPLOYEE_COUNT',
        '39' => 'EMPLOYER_ADDRESS_1',
        '40' => 'EMPLOYER_ADDRESS_2',
        '41' => 'EMPLOYER_ADDRESS_3',
        '42' => 'EMPLOYER_ADDRESS_4',
        '38' => 'EMPLOYER_COMPANY',
        '43' => 'EMPLOYER_POSTCODE',
        '46' => 'EMPLOYMENT_DESCRIPTION',
        '34' => 'EMPLOYMENT_TYPE',
        '266' => 'ENROLL_TIMEFRAME',
        '319' => 'EXPECTANT_PARENT',
        '78' => 'EXPERIENCE_LEVEL',
        '100' => 'F9CallASAP',
        '98' => 'F9domain',
        '99' => 'F9list',
        '101' => 'F9retResults',
        '304' => 'FINAL_EXPENSE_OPT_IN',
        '1' => 'FIRST_NAME',
        '55' => 'FIRST_PURCHASE_DATE',
        '243' => 'FLIGHT_DELAYED',
        '249' => 'FLIGHT_DELAY_LENGTH',
        '250' => 'FLIGHT_DELAY_REASON',
        '244' => 'FLIGHT_TYPE',
        '300' => 'FORM_CHOICE',
        '308' => 'FORM_ZIP_CODE',
        '263' => 'FREQUENCY',
        '208' => 'FULL_FORM',
        '222' => 'FULL_NAME',
        '86' => 'FUNCTION_ID',
        '11' => 'GENDER',
        '13' => 'GENERATED_AT',
        '111' => 'GENERATED_AT_DATE',
        '94' => 'GRAD_YEAR',
        '316' => 'HAS_ATTORNEY',
        '205' => 'HAS_CHECKING_ACCOUNT',
        '235' => 'HEALTH_INSURANCE',
        '305' => 'HEALTH_INSURANCE_OPT_IN',
        '262' => 'HEALTH_OPT_IN',
        '19' => 'HEIGHT_FEET',
        '20' => 'HEIGHT_INCHES',
        '227' => 'HIT_ID',
        '31' => 'HOMEOWNER_TENANT',
        '51' => 'HOME_OWNER',
        '4' => 'HOME_PHONE',
        '233' => 'HOME_REMODEL',
        '270' => 'HOUSEHOLD_INCOME',
        '293' => 'HOUSEHOLD_SIZE',
        '33' => 'HOUSE_NAME',
        '32' => 'HOUSE_NUMBER',
        '186' => 'HOW_LONG_WITHOUT',
        '175' => 'HTTP_REFERER',
        '154' => 'HTTP_USER_AGENT',
        '63' => 'INSERT_DATE',
        '291' => 'INSURANCE_TYPE',
        '311' => 'INTEREST',
        '12' => 'IP_ADDRESS',
        '253' => 'IP_CITY',
        '252' => 'IP_COUNTRY',
        '258' => 'IP_MOBILE_BRAND',
        '255' => 'IP_REGION',
        '257' => 'IP_USAGE_TYPE',
        '256' => 'IP_ZIP_CODE',
        '211' => 'IS_BOT',
        '79' => 'IS_CITIZEN',
        '24' => 'IS_EMAIL_AUTHORIZED',
        '25' => 'IS_POSTAL_AUTHORIZED',
        '26' => 'IS_SMS_AUTHORIZED',
        '27' => 'IS_TELEMARKETING_AUTHORIZED',
        '199' => 'IS_VALID_LEAD',
        '56' => 'JOB_SEARCH',
        '115' => 'JOB_TITLE',
        '203' => 'JOB_TYPE',
        '204' => 'KNOWS_CREDIT_RATING',
        '267' => 'LANDER',
        '2' => 'LAST_NAME',
        '57' => 'LEAD_ID',
        '59' => 'LEAD_SOURCE',
        '225' => 'LEAD_STATUS',
        '61' => 'LEAD_TYPE',
        '201' => 'LENDER',
        '241' => 'LEX_OPT_IN',
        '187' => 'LIFE_DECISIONS',
        '167' => 'LIST_CATEGORY_ID',
        '122' => 'LIST_ID',
        '209' => 'LIST_KEY',
        '190' => 'LOAN_AMOUNT',
        '47' => 'LOAN_PURPOSE',
        '161' => 'LOAN_TYPE',
        '129' => 'MACHINE_MADE_CIGAR_BRAND',
        '110' => 'MANAGER_LIST_ID',
        '166' => 'MANAGER_POST_ID',
        '29' => 'MARITAL_STATUS',
        '268' => 'MD5',
        '292' => 'MEDICAL_CONDITIONS',
        '132' => 'MEDICAL_COVERAGE',
        '213' => 'MEMBER_ID',
        '107' => 'MIDDLE_INITIAL',
        '223' => 'MILITARY_MEMBER',
        '5' => 'MOBILE_PHONE',
        '290' => 'MONTHLY_INCOME',
        '52' => 'MONTHLY_POWER_BILL',
        '188' => 'MOST_IMPORTANT',
        '35' => 'NET_INCOME',
        '189' => 'NUMBER_OF_LOANS',
        '248' => 'NUMBER_OF_PASSENGERS',
        '67' => 'OFFER_ID',
        '50' => 'OFFER_TYPE_ID',
        '174' => 'OM_KEYWORD',
        '142' => 'OPT_IN',
        '88' => 'ORDER_REASON',
        '130' => 'OTHER_CIGAR_BRAND',
        '299' => 'OVERSTOCK_OPT_IN',
        '164' => 'OWNER_LIST_ID',
        '163' => 'OWNER_POST_ID',
        '230' => 'OWN_VEHICLE',
        '162' => 'PAIN_TYPE',
        '103' => 'PASSWORD',
        '281' => 'PAYCHECK',
        '285' => 'PAYDATE_CURRENT',
        '284' => 'PAYDATE_LAST',
        '286' => 'PAYDATE_NEXT',
        '297' => 'PAYDAY_DEBT_OPT_IN',
        '282' => 'PAY_INTERVAL',
        '92' => 'PHONE',
        '219' => 'PHONE_NUMBER',
        '73' => 'PHONE_TYPE',
        '109' => 'PLACEMENT',
        '76' => 'POSITION_TYPE',
        '65' => 'POSTED',
        '84' => 'POST_REQUEST',
        '15' => 'POST_STOP',
        '307' => 'PREEXISTING_CONDITION',
        '119' => 'PRODUCT',
        '69' => 'PROMOTION_ID',
        '182' => 'PURCHASE_TYPE',
        '320' => 'QUALIFYING_LIFE_EVENT',
        '185' => 'QUIT_METHOD',
        '315' => 'REAL_ESTATE',
        '144' => 'REASON_CREDITOR_HARASSMENT',
        '151' => 'REASON_DIVORCE',
        '146' => 'REASON_FORECLOSURE',
        '143' => 'REASON_GARNISHMENT',
        '148' => 'REASON_ILLNESS_OR_DISABILITY',
        '147' => 'REASON_LAWSUITS',
        '152' => 'REASON_LICENSE_SUSPENSION',
        '150' => 'REASON_LOSS_OF_INCOME',
        '149' => 'REASON_OTHER',
        '145' => 'REASON_REPOSSESSION',
        '283' => 'REMARKETABLE',
        '274' => 'RENT_OR_OWN',
        '128' => 'RESIDENCY',
        '276' => 'ROUTING_NUMBER',
        '214' => 'RXBIN',
        '216' => 'RXGRP',
        '215' => 'RXPCN',
        '81' => 'SALARY_MAX',
        '80' => 'SALARY_MIN',
        '303' => 'SAY_SO_OPT_IN',
        '240' => 'SELLER_KEY',
        '137' => 'SEQUENCE_ID',
        '176' => 'SERVER_IP_ADDRESS',
        '309' => 'SESSION_ID',
        '321' => 'SESSION_LENGTH',
        '310' => 'SID',
        '138' => 'SITE_ID',
        '108' => 'SOCIAL_SECURITY_NUMBER',
        '62' => 'SOLD_AS_AGED',
        '96' => 'SOURCE',
        '16' => 'SOURCE_DOMAIN',
        '49' => 'SOURCE_FILENAME',
        '112' => 'SOURCE_ID',
        '313' => 'SOURCE_IP',
        '113' => 'SOURCE_PASSWORD',
        '85' => 'SPECIALIZATION_ID',
        '302' => 'SSDI_OPT_IN',
        '8' => 'STATE',
        '54' => 'STREET_ADDRESS',
        '259' => 'STUDENT_DEBT_OPT_IN',
        '271' => 'STUDENT_LOAN_DEBT',
        '251' => 'STUDENT_STATUS',
        '22' => 'SUBID_1',
        '23' => 'SUBID_2',
        '169' => 'SUBSCRIBER_ID',
        '106' => 'SUB_ID',
        '301' => 'TAGS',
        '296' => 'TAX_DEBT_OPT_IN',
        '264' => 'TCPA',
        '124' => 'TERM_OF_COVERAGE',
        '120' => 'TESTING',
        '218' => 'TICKETS',
        '17' => 'TIME_TO_CALL',
        '28' => 'TITLE',
        '18' => 'TOBACCO',
        '158' => 'TOPICA_LIST_ID',
        '314' => 'TOTAL_ASSETS',
        '141' => 'TOTAL_DEBT',
        '139' => 'TOTAL_MONTHLY_EXPENSES',
        '140' => 'TOTAL_MONTHLY_INCOME',
        '239' => 'TRACKING_TOKEN_ID',
        '312' => 'TRANSID',
        '121' => 'TRANSPARENT_MODE',
        '184' => 'TRIED_QUITTING',
        '126' => 'TRUSTED_FORM_CERT_URL',
        '177' => 'TYPE_OF_PROCEDURE',
        '90' => 'UNSUBSCRIBE_URL',
        '102' => 'USERNAME',
        '231' => 'VALID_DRIVERS_LICENSE',
        '48' => 'VALUE',
        '21' => 'WEIGHT',
        '317' => 'WILLING_TO_PAY',
        '68' => 'WORKFLOW_TOKEN',
        '294' => 'WORK_FROM_HOME',
        '9' => 'ZIP_CODE',
    );
}